# ユーザーガイド / User Guide

鋼板切断最適化システム 操作手順書

## 📖 目次 / Table of Contents

1. [🚀 はじめに / Getting Started](#-はじめに--getting-started)
2. [🏭 材料在庫管理 / Material Inventory Management](#-材料在庫管理--material-inventory-management)
3. [⚡ 切断最適化 / Cutting Optimization](#-切断最適化--cutting-optimization)
4. [📊 結果の確認・出力 / Results and Outputs](#-結果の確認出力--results-and-outputs)
5. [🔧 設定とカスタマイズ / Settings and Customization](#-設定とカスタマイズ--settings-and-customization)
6. [🆘 トラブルシューティング / Troubleshooting](#-トラブルシューティング--troubleshooting)

## 🚀 はじめに / Getting Started

### システム起動
1. **コマンドプロンプト**を開いて、プロジェクトフォルダに移動
2. 仮想環境を有効化: `venv\Scripts\activate`
3. アプリケーションを起動: `streamlit run app.py`
4. ブラウザで `http://localhost:8501` にアクセス

### 初回セットアップ
システム初回起動時に自動的にサンプルデータが読み込まれます：
- **材料在庫データ** (`sample_data/sizaidata.txt`)
- **切断データサンプル** (`sample_data/data0923.txt`)

## 🏭 材料在庫管理 / Material Inventory Management

### 材料管理ページへのアクセス
1. サイドバーの**「📦 材料管理 / Material Management」**を選択
2. 材料管理ページが表示されます

### 在庫データの確認
材料管理ページでは以下の情報を確認できます：
- **材料コード**: SECC, KW-300, S-203 など
- **材質タイプ**: 材料の種類
- **幅・高さ**: 材料シートのサイズ（mm）
- **面積**: 材料シートの面積（mm²）
- **在庫数**: 利用可能な枚数
- **単価**: 1枚あたりのコスト

### 新しい材料の追加
1. **「新しい材料を追加」**セクションを展開
2. 必要な情報を入力：
   - 材料コード（例：`SECC_1.6_1500x3100`）
   - 材質タイプ（例：`SECC`）
   - 板厚（mm）
   - 幅・高さ（mm）
   - 単価（円）
   - 在庫数（枚）
3. **「材料を追加」**ボタンをクリック

### 材料データの一括インポート
1. **「ファイルから材料データを読み込み」**セクションを使用
2. サポートする形式：
   - **TSV形式** (`sizaidata.txt`)
   - **CSV形式**
   - **JSON形式**
3. ファイルをアップロードまたはテキストを貼り付け
4. **「データを読み込み」**ボタンをクリック

### 在庫の更新・削除
- **更新**: 材料行の編集フィールドで数量や単価を変更
- **削除**: 削除ボタンで不要な材料を削除
- **一括削除**: 複数選択して一括削除

## ⚡ 切断最適化 / Cutting Optimization

### 最適化ページの使用
1. サイドバーの**「🔧 最適化 / Optimization」**を選択
2. パネル情報の入力を開始

### パネル情報の入力方法

#### 方法1: サンプルデータの使用
1. **「サンプルデータを読み込み」**ボタンをクリック
2. `data0923.txt`から実際の切断データが読み込まれます
3. 材料検証が自動実行されます

#### 方法2: ファイルからの読み込み
1. **「ファイルアップロード」**タブを選択
2. 対応形式：
   - **TSV** (タブ区切り)
   - **CSV** (カンマ区切り)
   - **JSON**
   - **固定幅**
3. ファイルをドラッグ&ドロップまたは選択
4. **「データを解析」**ボタンをクリック

#### 方法3: 手動入力
1. **「手動入力」**タブを選択
2. 各パネルの情報を入力：
   - **ID**: パネル識別子
   - **幅・高さ**: サイズ（mm）
   - **数量**: 必要枚数
   - **材質**: 材料タイプ
   - **板厚**: 厚さ（mm）
   - **回転許可**: パネル回転の可否
3. **「パネルを追加」**ボタンでリストに追加

### 材料検証の確認
パネル入力後、システムが自動的に材料検証を実行：
- ✅ **検証OK**: 在庫に適合する材料が存在
- ⚠️ **警告**: 在庫不足や材料なし
- **詳細情報**: 利用可能なシート数や代替材料

### 母材設定
1. **「母材設定」**セクションで以下を設定：
   - **幅・高さ**: 標準1500×3100mm
   - **材質**: 使用する材料タイプ
   - **単価**: 1枚あたりのコスト

### 最適化設定
1. **「最適化設定」**で以下を選択：
   - **アルゴリズム**:
     - `AUTO`: 自動選択（推奨）
     - `FFD`: 高速処理（≤10パネル）
     - `BFD`: 高効率（≤30パネル）
     - `HYBRID`: 最高効率（≤50パネル）
   - **制約条件**:
     - 切断代（ケルフ）: 通常3.5mm
     - 最小パネルサイズ: 50×50mm
     - 回転許可: デフォルトON

### 最適化実行
1. **「🚀 最適化実行 / Run Optimization」**ボタンをクリック
2. プログレスバーで進行状況を確認
3. 完了まで数秒〜数十秒

## 📊 結果の確認・出力 / Results and Outputs

### 最適化結果の表示
最適化完了後、以下の情報が表示されます：

#### サマリーメトリクス
- **配置パネル数**: 成功配置されたパネル数
- **平均効率**: 材料効率（%）
- **総コスト**: 使用材料の総費用
- **処理時間**: 最適化にかかった時間

#### インタラクティブ可視化
- **切断レイアウト図**: Plotlyによるインタラクティブ表示
- **色分けパネル**: パネルごとに異なる色で表示
- **切断線表示**: ギロチンカット線の表示
- **寸法表示**: パネルサイズと位置座標
- **ズーム・パン**: マウス操作で詳細確認

#### パネル詳細情報
メインページに移動したパネル詳細表示：
- **配置成功**: ✅ 緑色で表示
- **配置失敗**: ❌ 赤色で表示
- **配置座標**: (x, y) 位置
- **回転状態**: 回転された場合は表示

### エクスポート・ダウンロード機能

#### 作業指示書生成
1. **「📋 作業指示書生成」**ボタンをクリック
2. シートごとに以下が生成：
   - **基本情報**: シートID、材質、ステップ数
   - **切断順序**: 最適化された作業手順
   - **品質情報**: 複雑度、切断長、安全注意
   - **予想時間**: 作業完了までの時間

#### レポート出力
1. **「📊 レポート出力」**ボタンをクリック
2. **Excel形式**での詳細レポート：
   - 効率分析チャート
   - コスト内訳
   - 材料使用状況
   - 最適化パラメータ
3. **ダウンロード**ボタンでファイル取得

#### 結果保存
1. **「💾 結果保存」**ボタンでセッション保存
2. **JSON形式**でのデータ保存：
   - 最適化パラメータ
   - 配置結果
   - 効率メトリクス
   - タイムスタンプ

## 🔧 設定とカスタマイズ / Settings and Customization

### アルゴリズム選択の指針

#### 用途別推奨アルゴリズム
```
小規模（≤10パネル）:
├─ 高速重視 → FFD（<1秒、効率70-75%）
└─ 効率重視 → BFD（<3秒、効率80-85%）

中規模（≤30パネル）:
├─ バランス → BFD（<10秒、効率80-85%）
└─ 最高効率 → HYBRID（<15秒、効率85%+）

大規模（≤100パネル）:
└─ 最適解 → HYBRID（<30秒、ベストエフォート）
```

### 制約条件のカスタマイズ
- **切断代**: 機械に応じて2-5mm
- **最小サイズ**: 安全基準に応じて調整
- **最大サイズ**: 設備能力に応じて設定
- **回転許可**: 作業効率とのバランス

### 材料管理のベストプラクティス
1. **定期的な在庫更新**: 実在庫との同期
2. **材料コード統一**: 一貫した命名規則
3. **廃材管理**: 小サイズ材料の有効活用
4. **コスト管理**: 市況変動に応じた単価更新

## 🆘 トラブルシューティング / Troubleshooting

### よくある問題と解決方法

#### Q1: 材料検証エラーが発生する
**症状**: 「Material type 'XXX' not available」
**原因**: 材料在庫にない材質コードを指定
**解決方法**:
1. 材料管理ページで在庫を確認
2. 材料コードのスペルチェック
3. 必要に応じて新しい材料を追加

#### Q2: パネルが配置されない
**症状**: 「No available sheets can accommodate」
**原因**: パネルサイズが材料サイズを超過
**解決方法**:
1. パネルサイズを確認（最大1500×3100mm）
2. 回転許可を有効にする
3. より大きな母材を使用

#### Q3: 最適化が終わらない
**症状**: プログレスバーが進まない
**原因**: パネル数が多すぎるか複雑
**解決方法**:
1. パネル数を50個以下に分割
2. より高速なアルゴリズム（FFD）を選択
3. ブラウザを更新して再実行

#### Q4: メモリエラーが発生
**症状**: 「Memory allocation failed」
**原因**: 大量データでメモリ不足
**解決方法**:
1. ブラウザの他のタブを閉じる
2. データを分割して処理
3. システムメモリを増設

#### Q5: ファイルが読み込めない
**症状**: 「File parsing failed」
**原因**: ファイル形式が非対応
**解決方法**:
1. 対応形式を確認（TSV, CSV, JSON）
2. 文字エンコーディングをUTF-8に変更
3. ヘッダー行の有無を確認

### エラーメッセージ一覧

| エラーコード | メッセージ | 原因 | 対処法 |
|-------------|-----------|------|--------|
| `MATERIAL_NOT_FOUND` | 材質が見つかりません | 在庫にない材質指定 | 材料管理で追加 |
| `SIZE_CONSTRAINT_VIOLATION` | サイズ制約違反 | パネルが大きすぎる | サイズ確認・回転許可 |
| `OPTIMIZATION_TIMEOUT` | 最適化タイムアウト | 処理時間超過 | アルゴリズム変更 |
| `INSUFFICIENT_INVENTORY` | 在庫不足 | 必要数量不足 | 在庫追加・分割処理 |
| `PARSE_ERROR` | データ解析エラー | ファイル形式不正 | 形式確認・修正 |

### パフォーマンス最適化のコツ

#### データ入力の最適化
- **事前整理**: パネルデータの事前整理
- **バッチ処理**: 同一材質のまとめ処理
- **優先度設定**: 重要パネルの優先配置

#### システム設定の最適化
- **ブラウザ設定**: Chrome推奨、キャッシュクリア
- **メモリ管理**: 他アプリケーションの終了
- **ネットワーク**: ローカル実行で高速化

### サポート・お問い合わせ

#### 技術サポート
- **GitHub Issues**: バグレポート・機能要求
- **ドキュメント**: 追加の技術情報
- **コミュニティ**: ユーザー同士の情報交換

#### システム要件の確認
```bash
# Pythonバージョン確認
python --version

# 依存関係確認
pip list

# メモリ使用量確認
# タスクマネージャーでstreamlit.exeをチェック
```

#### ログの確認
- **ブラウザ**: F12でデベロッパーツール
- **コンソール**: エラーメッセージの確認
- **ネットワーク**: API通信の状態確認

---

## 📚 関連ドキュメント / Related Documentation

- [📋 **プロジェクト仕様書**](../steel_cutting_spec.md) - 技術仕様詳細
- [🏗️ **アーキテクチャ概要**](architecture.md) - システム設計
- [📊 **API リファレンス**](api_reference.md) - 外部連携仕様
- [⚙️ **開発ガイド**](../CLAUDE.md) - 開発者向け情報

---

**最終更新**: 2025年1月22日 | **システムバージョン**: v1.0.0